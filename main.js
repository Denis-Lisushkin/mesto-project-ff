(()=>{"use strict";const e=(e,t,o,r,n)=>{const a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button"),s=a.querySelector(".card__image"),l=a.querySelector(".card__like-counter");return a.querySelector(".card__title").textContent=e.name,l.textContent=e.likes.length,s.src=e.link,s.alt=`на изображении ${e.name}`,s.addEventListener("click",(()=>r(e))),i.addEventListener("click",(()=>o(e._id,i,l))),e.likes.some((e=>e._id===n))&&i.classList.add("card__like-button_is-active"),e.owner._id!==n?c.remove():c.addEventListener("click",(()=>{t(e._id).then((e=>{a.remove()})).catch((e=>{console.log(e)}))})),a};function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",r)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}const n=(e,t,o)=>{const r=t.querySelector(`.${o.id}-error`);o.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""},a=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(t)?i(o,e):(o.disabled=!1,o.classList.remove(e.inactiveButtonClass))},c=(e,t)=>{Array.from(t.querySelectorAll(e.inputSelector)).forEach((o=>{n(e,t,o)})),i(t.querySelector(e.submitButtonSelector),e)},i=(e,t)=>{e.disable,e.classList.add(t.inactiveButtonClass)},s="1fcbb7db-2196-4d12-a10f-03fef2f41234",l="wff-cohort-20",u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),p=e=>fetch(`https://nomoreparties.co/v1/${l}/cards/${e}`,{method:"DELETE",headers:{authorization:s,"Content-Type":"application/json"}}).then((e=>u(e))),d=document.querySelector(".places__list"),_=document.querySelector(".profile__image"),m=document.querySelector(".popup_type_avatar"),y=document.querySelector("form[name='edit-avatar']"),h=y.querySelector(".popup__input_type_url"),v=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit"),S=document.querySelector("form[name='edit-profile']"),q=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),L=S.querySelector(".popup__input_type_name"),g=S.querySelector(".popup__input_type_description"),E=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_new-card"),x=document.querySelector("form[name='new-place']"),$=x.querySelector(".popup__input_type_card-name"),T=x.querySelector(".popup__input_type_url"),A=document.querySelector(".popup_type_image"),j=A.querySelector(".popup__image"),z=A.querySelector(".popup__caption"),B=document.querySelectorAll(".popup");let D;const P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},w=(e,t,o)=>{q.textContent=e,b.textContent=t,C.style=`background-image: url(${o})`},N=e=>{j.src=e.link,j.alt=e.name,z.textContent=e.name,t(A)};function O(e,t,o){t.classList.contains("card__like-button_is-active")?(e=>fetch(`https://nomoreparties.co/v1/${l}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:s,"Content-Type":"application/json"}}).then((e=>u(e))))(e).then((e=>{o.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((e=>{console.log(e)})):(e=>fetch(`https://nomoreparties.co/v1/${l}/cards/likes/${e}`,{method:"PUT",headers:{authorization:s,"Content-Type":"application/json"}}).then((e=>u(e))))(e).then((e=>{o.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((e=>{console.log(e)}))}Promise.all([fetch(`https://nomoreparties.co/v1/${l}/users/me`,{headers:{authorization:s}}).then((e=>u(e))),fetch(`https://nomoreparties.co/v1/${l}/cards`,{headers:{authorization:s}}).then((e=>u(e)))]).then((([t,o])=>{D=t._id,w(t.name,t.about,t.avatar),o.forEach((function(t){d.append(e(t,p,O,N,D))}))})).catch((e=>console.log(e))),v.addEventListener("click",(e=>{c(P,f),L.value=q.textContent,g.value=b.textContent,t(f)})),E.addEventListener("click",(e=>{c(P,k),$.value="",T.value="",t(k)})),_.addEventListener("click",(e=>{c(P,m),h.value="",t(m)})),B.forEach((e=>{e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(()=>{o(e)})),e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup")&&o(e)}))})),S.addEventListener("submit",(function(e){var t,r;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=L.value,r=g.value,fetch(`https://nomoreparties.co/v1/${l}/users/me`,{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:r})}).then((e=>u(e)))).then((e=>{w(e.name,e.about,e.avatar),o(f)})).catch((e=>{console.log(e)})).finally((()=>{e.target.querySelector(".popup__button").textContent="Сохранить"}))})),x.addEventListener("submit",(function(t){t.preventDefault(),t.target.querySelector(".popup__button").textContent="Сохранение...";const r={name:$.value,link:T.value};var n,a;(n=r.name,a=r.link,fetch(`https://nomoreparties.co/v1/${l}/cards`,{method:"POST",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:a})}).then((e=>u(e)))).then((t=>{d.prepend(e(t,p,O,N,D)),x.reset(),o(k)})).catch((e=>{console.log(e)})).finally((()=>{t.target.querySelector(".popup__button").textContent="Сохранить"}))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=h.value,fetch(`https://nomoreparties.co/v1/${l}/users/me/avatar`,{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((e=>u(e)))).then((e=>{console.log(e),w(e.name,e.about,e.avatar),y.reset(),o(m)})).catch((e=>{console.log(e)})).finally((()=>{e.target.querySelector(".popup__button").textContent="Сохранить"}))})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(function(e){e.preventDefault()})),((e,t)=>{const o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);a(e,o,r),o.forEach((c=>{c.addEventListener("input",(function(){((e,t,o)=>{o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?n(e,t,o):((e,t,o,r)=>{const n=t.querySelector(`.${o.id}-error`);o.classList.add(e.inputErrorClass),n.textContent=r,n.classList.add(e.errorClass)})(e,t,o,o.validationMessage)})(e,t,c),a(e,o,r)}))}))})(e,t)}))})(P)})();